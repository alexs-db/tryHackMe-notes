# DNS Configuration

To perform exfiltration via the DNS protocol, you need to control a domain name and set up DNS records, including NS, A, or TXT. A web interface is provided to make it easy to add and modify DNS records. The following domain name is set up and ready for the DNS exfiltration task: **tunnel.com**.

To access the website, visit the following link:  
[http://10.10.82.84/](http://10.10.82.84/) or [https://10-10-82-84.p.thmlabs.com/](https://10-10-82-84.p.thmlabs.com/) without the need for a VPN.

## THM DNS Changer - The Main Web Interface

Once you choose the domain name, you can:
- Add DNS records
- Test DNS configurations
- Reset DNS configurations if needed

### DNS Management for tunnel.com

#### New Attacker Machine

A new attacker machine has been added in **Network 2** with the following details:

| Domain Name       | IP Address   | Network Access |
|-------------------|--------------|----------------|
| attacker.thm.com  | 172.20.0.200 | Network 2      |

This attacker machine will be used for DNS exfiltration and tunneling scenarios. The goal is for the attacker machine (on **Network 2**) to access internal network devices of **Network 1** through the JumpBox.

---

## DNS Tunneling Goal

### Nameserver for DNS Exfiltration

To execute DNS exfiltration within the provided network or on the Internet, set up a nameserver for the domain name as follows:

1. **Add an A record**:
    - **Type**: A  
    - **Subdomain Name**: t1ns  
    - **Value**: AttackBox_IP  

2. **Add an NS record**:
    - **Type**: NS  
    - **Subdomain Name**: t1  
    - **Value**: t1ns.tunnel.com  

Ensure the NS value specifies the full domain name: `t1ns.tunnel.com`. Once these records are added, the nameserver `t1.tunnel.com` is ready for DNS exfiltration.

If you choose not to set up your AttackBox, a nameserver is pre-configured for the attacker machine within the provided network:

| DNS Record         | Type | Value             |
|--------------------|------|-------------------|
| attNS.tunnel.com   | A    | 172.20.0.200      |
| att.tunnel.com     | NS   | attNS.tunnel.com  |

The `attNS.tunnel.com` IP address points to the attacker machine in the network, ready for DNS tasks between the JumpBox and the attacker.

---

## Lab Recommendation

While you can use the AttackBox for this room, it is recommended to use the JumpBox for most tasks (TCP, SSH, ICMP, DNS) to avoid technical issues. If you prefer to use the AttackBox for the DNS tunneling task (Task 10), you must change its DNS settings to `10.10.82.84`. 

### Changing DNS Settings in the AttackBox

Edit the YAML Netplan configuration file:

```bash
root@AttackBox:~# nano /etc/netplan/aws-vmimport-netplan.yaml
```

Modify the file to include the nameserver section under the `eth0` interface:

```yaml
# Automatically generated by the vm import process
network:
     ethernets:
          eth0:
                dhcp4: true
                optional: false
                nameservers:
                     search: [tunnel.com]
                     addresses: [10.10.82.84]
          ens5:
                dhcp4: true
                optional: false
     version: 2
```

Apply the Netplan changes (this may need to be run twice):

```bash
root@AttackBox:~# netplan apply
```

---

## DNS Testing

Once you have access to the JumpBox, test the DNS configuration as follows:

```bash
thm@jump-box:~$ dig +short test.thm.com
127.0.0.1

thm@jump-box:~$ ping test.thm.com -c 1
PING test.thm.com (127.0.0.1) 56(84) bytes of data.
64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.018 ms

--- test.thm.com ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.018/0.018/0.018/0.000 ms
```

The DNS server must resolve `test.thm.com` and `test.tunnel.com` to `127.0.0.1`, confirming that the setup is ready.