# Introduction

This network is the continuation of the **Breaching AD** and **Enumerating AD** networks. Please complete those networks before starting this one. We will discuss AD objects extensively—if you need a refresher, review the previous room. Now that we have breached AD and enumerated the domain structure, we will explore methods to exploit misconfigurations identified during enumeration.

---

## AD Exploitation

After internal reconnaissance and understanding the AD environment, we move to the exploitation phase. This phase involves leveraging misconfigurations for lateral movement and privilege escalation, as shown in the diagram below. Persistence is usually combined with exploitation (covered in the next room), as is further enumeration from new positions.

---

## Learning Objectives

In this network, we will cover several methods to exploit AD misconfigurations. This is not an exhaustive list—methods are highly situational and depend on the AD structure and environment. We will cover:

- AD Delegation
- Forcing Authentication Relays
- Group Policy Objects
- Targeting AD Users
- Domain Trusts
- Silver and Golden Tickets

---

## AttackBox

If you are using the web-based AttackBox, you will be connected automatically when starting the AttackBox from the room's page. Verify connectivity by running:

```bash
ping <THMDC_IP>
```

**Note:** The domain suffix for this network is `.loc` (not `.com`). DNS configuration is required. Windows networks use DNS to resolve hostnames to IPs. Throughout this network, DNS will be used for tasks.

To configure DNS on your host (running the VPN connection), run:

```bash
sed -i '1s|^|nameserver $THMDCIP\n|' /etc/resolv-dnsmasq
```

Replace `$THMDCIP` with the IP of THMDC in your network diagram. Test DNS with:

```bash
nslookup thmdc.za.tryhackme.loc
```

This should resolve to your DC's IP.

> **Note:** DNS may reset on the AttackBox every ~3 hours. If so, repeat the command above. If your AttackBox terminates, redo all DNS steps when you return.

Also, note your VPN IP using `ifconfig` or `ip a`. Identify the IP of the `exploitad` network adapter—this is your IP/interface for attacks.

---

## Other Hosts

If using your own attack machine, an OpenVPN configuration file is generated after joining the room. Go to your access page, select **EnumeratingAD** from the VPN servers (under the network tab), and download your config file.

Connect using an OpenVPN client (example for Linux):

```bash
sudo openvpn exploitingad.ovpn
```

Sample output:

```
Fri Mar 11 15:06:20 2022 OpenVPN 2.4.9 x86_64-redhat-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Apr 19 2020
Fri Mar 11 15:06:20 2022 library versions: OpenSSL 1.1.1g FIPS  21 Apr 2020, LZO 2.08
[...]
Fri Mar 11 15:06:22 2022 /sbin/ip link set dev tun0 up mtu 1500
Fri Mar 11 15:06:22 2022 /sbin/ip addr add dev tun0 10.50.2.3/24 broadcast 10.50.2.255
Fri Mar 11 15:06:22 2022 /sbin/ip route add 10.200.4.0/24 metric 1000 via 10.50.2.1
Fri Mar 11 15:06:22 2022 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this
Fri Mar 11 15:06:22 2022 Initialization Sequence Completed
```

The message **"Initialization Sequence Completed"** confirms network connection. Refresh your access page to verify (look for a green tick and your internal IP).

> **Note:** You still need to configure DNS as shown above. The DC logs DNS requests, which may include your device's hostname.

---

## Kali

If using a Kali VM, Network Manager likely manages DNS. Configure DNS via GUI:

- **Network Manager → Advanced Network Configuration → Your Connection → IPv4 Settings**
- Set DNS IP to the IP for **THMCHILDDC** (see network diagram)
- Add another DNS (e.g., `1.1.1.1`) to retain internet access
- Run `sudo systemctl restart NetworkManager` and test DNS as above

---

## Requesting Your Credentials

To simulate an AD breach, you will receive your first set of AD credentials. Once networking is set up, navigate to:

```
http://distributor.za.tryhackme.loc/creds
```

Click **"Get Credentials"** to receive your credential pair for initial access.

This pair provides RDP and SSH access to `THMWRK1.za.tryhackme.loc` (a jump host simulating a foothold). Use Remmina or similar for RDP—specify the domain `za.tryhackme.loc` when connecting.

For SSH access:

```bash
ssh za.tryhackme.loc\\<AD Username>@thmwrk1.za.tryhackme.loc
```

When prompted, enter your account password. SSH is typically faster than RDP for these tasks.