# Arbitrary Origin

Exploiting an Arbitrary Origin vulnerability is relatively easy compared to other CORS vulnerabilities since the application accepts cross-origin requests from any domain name. For example, below is the vulnerable code of `http://corssop.thm/arbitrary.php`:

```php
if (isset($_SERVER['HTTP_ORIGIN'])){
    header("Access-Control-Allow-Origin: ".$_SERVER['HTTP_ORIGIN']."");
    header('Access-Control-Allow-Credentials: true');
}
```

The code above implements a flawed CORS policy since it echoes back the Origin header from the client request in the `Access-Control-Allow-Origin` header without proper validation. An attacker might use an origin like `http://evilcors.thm` and the server will echo it back.

### Server echo the supplied origin

To exploit the vulnerable code above, go to `http://exploit.evilcors.thm`. The exploit server has an existing JavaScript code that makes cross-origin requests to the target application. The sample exploit code can be found at `http://corssop.thm/exploits/data_exfil.html`. The exploit code uses `XMLHttpRequest` to send requests to the vulnerable application and process the response. The processed response will be sent to the web server with the `receiver.php` file.

In the exploit code, change the target URL to `http://corssop.thm/arbitrary.php`.

### Change the target to arbitrary.php

Also, change the URL of the web server that will receive the exfiltrated data. If you're using AttackBox, use the pattern `ATTACKER_IP:81` since Apache runs on port 81. Feel free to change the port if you're using your machine.

### Change the exfiltrator server

Once done with the updates, click the Save button. To verify if the exploit is working, click the View exploit button. This will open a new tab containing the exploit code saved in the hosting server.

In the newly opened tab, open Developer tools > Network. There should be two XHR connections. The first request is sent to the target website, while the second is sent to the exfiltrating server.

### Two XHR requests in the network tab

You can now click the Send to victim button on the Exploit server's homepage.

**Note:** The victim will automatically visit the evil website containing the exploit code
